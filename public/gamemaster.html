<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GM Control</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; background: #f4f4f4; }
        h1 { text-align: center; color: #333; }
        
        .controls { display: flex; gap: 10px; justify-content: center; margin-bottom: 30px; }
        button { padding: 15px 30px; font-size: 1.2rem; cursor: pointer; border: none; border-radius: 8px; color: white; font-weight: bold;}
        .btn-start { background: #2ecc71; }
        .btn-stop { background: #e74c3c; }
        .btn-start:hover { background: #27ae60; }
        .btn-stop:hover { background: #c0392b; }

        .results { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .vote-item { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
        .vote-choice { font-weight: bold; padding: 2px 8px; border-radius: 4px; color: white;}
        
        /* Farben f√ºr die Antworten */
        .choice-A { background: #e74c3c; }
        .choice-B { background: #f1c40f; color: black; }
        .choice-C { background: #2ecc71; }
        .choice-D { background: #3498db; }
    </style>
</head>
<body>

    <h1>üéÆ Gamemaster Zentrale</h1>
    
    <div class="controls">
        <button class="btn-start" onclick="sendAction('reset')">‚ñ∂ Neue Runde / Reset</button>
        <button class="btn-stop" onclick="sendAction('stop')">‚èπ Stop Voting</button>
    </div>

    <div class="results">
        <h3>Live Ergebnisse: <span id="count">0</span> Votes</h3>
        <div id="vote-list">
            <!-- Hier erscheinen die Votes live -->
            <p style="color:#999; text-align:center;">Warte auf Votes...</p>
        </div>
    </div>

    <!-- Wichtig: Socket.io Client Library -->
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        // 1. Befehle senden
        function sendAction(action) {
            socket.emit('gm_control', action);
        }

        // 2. Ergebnisse empfangen
        socket.on('update_votes', (votes) => {
            const list = document.getElementById('vote-list');
            const countSpan = document.getElementById('count');
            
            list.innerHTML = '';
            const total = Object.keys(votes).length;
            countSpan.innerText = total;

            if (total === 0) {
                list.innerHTML = '<p style="color:#999; text-align:center;">Warte auf Votes...</p>';
                return;
            }

            // Liste rendern
            for (const [user, choice] of Object.entries(votes)) {
                const div = document.createElement('div');
                div.className = 'vote-item';
                div.innerHTML = `
                    <span>üë§ ${user}</span>
                    <span class="vote-choice choice-${choice}">${choice}</span>
                `;
                list.appendChild(div);
            }
        });

        // 3. KEEP-ALIVE PING (WICHTIG F√úR RENDER.COM)
        // Ping alle 4 Minuten (240.000ms), damit der Server wach bleibt
        setInterval(() => {
            fetch('/')
                .then(() => console.log('üíì Keep-Alive Ping gesendet'))
                .catch(e => console.error('Ping Error', e));
        }, 240000);

    </script>
</body>
</html>
